<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>Emotion Detection UI</title>
	<style>
		:root { --bg: #0b1220; --panel: #111a2b; --text: #e8eefc; --muted: #9fb0d1; --brand: #4f8cff; --ok: #00d4a6; --warn: #ffcc00; --err: #ff5c5c; }
		* { box-sizing: border-box; }
		body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial; background: radial-gradient(1200px 800px at 10% -10%, #1b2950, transparent), radial-gradient(1200px 800px at 110% 10%, #1b2d56, transparent), var(--bg); color: var(--text); }
		.container { max-width: 960px; margin: 0 auto; padding: 32px 20px 64px; }
		h1 { font-weight: 700; letter-spacing: 0.3px; margin: 12px 0 8px; }
		.sub { color: var(--muted); margin: 0 0 28px; }
		.panel { background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.03)); border: 1px solid rgba(255,255,255,0.08); border-radius: 14px; box-shadow: 0 10px 30px rgba(0,0,0,0.25), inset 0 1px 0 rgba(255,255,255,0.06); padding: 20px; }
		.form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
		.field { display: grid; gap: 8px; }
		label { font-weight: 600; color: var(--text); }
		input[type="file"] { background: #0f1728; color: var(--muted); padding: 10px; border: 1px dashed rgba(255,255,255,0.18); border-radius: 10px; }
		.btn { appearance: none; border: none; background: linear-gradient(180deg, #5fa0ff, #3a73f3); color: white; padding: 12px 16px; border-radius: 10px; font-weight: 700; cursor: pointer; box-shadow: 0 8px 20px rgba(79,140,255,0.35); display: inline-flex; align-items: center; gap: 8px; }
		.btn:disabled { opacity: 0.6; cursor: not-allowed; }
		.row { display: flex; gap: 12px; align-items: center; }
		.help { color: var(--muted); font-size: 14px; }
		.footer { margin-top: 20px; font-size: 13px; color: var(--muted); }
		code { background: rgba(255,255,255,0.06); padding: 2px 6px; border-radius: 6px; }
		#result { margin-top: 24px; }
		.card { padding: 16px; border: 1px solid rgba(255,255,255,0.12); border-radius: 12px; background: rgba(255,255,255,0.03); }
		.badge { display: inline-block; padding: 4px 10px; border-radius: 999px; font-weight: 700; font-size: 12px; }
		.badge.ok { background: rgba(0,212,166,0.15); color: var(--ok); border: 1px solid rgba(0,212,166,0.35); }
		.badge.low { background: rgba(255,92,92,0.15); color: var(--err); border: 1px solid rgba(255,92,92,0.35); }
		table { width: 100%; border-collapse: collapse; }
		th, td { padding: 10px; border-bottom: 1px solid rgba(255,255,255,0.1); text-align: left; }
		pre { white-space: pre-wrap; word-break: break-word; background: rgba(0,0,0,0.3); padding: 12px; border-radius: 8px; }
	</style>
</head>
<body>
	<div class="container">
		<h1>Emotion Detection</h1>
		<p class="sub">Upload EEG and ECG CSV files to get emotion predictions using your trained model.</p>
		<div class="panel">
			<form id="predict-form">
				<div class="form-grid">
					<div class="field">
						<label for="eeg">EEG CSV</label>
						<input id="eeg" name="eeg_file" type="file" accept=".csv" required />
						<span class="help">CSV format. If present, label column should be the last column.</span>
					</div>
					<div class="field">
						<label for="ecg">ECG CSV</label>
						<input id="ecg" name="ecg_file" type="file" accept=".csv" required />
						<span class="help">CSV format. If present, label column should be the last column.</span>
					</div>
				</div>
				<div class="row" style="margin-top: 12px;">
					<button id="submit" class="btn" type="submit">
						<span id="btn-text">Predict</span>
					</button>
					<span id="status" class="help"></span>
				</div>
			</form>
			<div id="result"></div>
		</div>
		<p class="footer">Endpoint: <code>POST /predict/</code>. Files are transmitted via <code>multipart/form-data</code>.</p>
	</div>
	<script>
	const form = document.getElementById('predict-form');
	const submitBtn = document.getElementById('submit');
	const btnText = document.getElementById('btn-text');
	const statusEl = document.getElementById('status');
	const resultEl = document.getElementById('result');

	function setLoading(isLoading, message = '') {
		submitBtn.disabled = isLoading;
		btnText.textContent = isLoading ? 'Predicting…' : 'Predict';
		statusEl.textContent = message;
	}

	form.addEventListener('submit', async (e) => {
		e.preventDefault();
		resultEl.innerHTML = '';
		const eeg = document.getElementById('eeg').files[0];
		const ecg = document.getElementById('ecg').files[0];
		if (!eeg || !ecg) {
			statusEl.textContent = 'Please select both EEG and ECG CSV files.';
			return;
		}
		try {
			setLoading(true, 'Uploading files…');
			const fd = new FormData();
			fd.append('eeg_file', eeg);
			fd.append('ecg_file', ecg);
			const res = await fetch('/predict/', { method: 'POST', body: fd });
			const data = await res.json();
			if (!res.ok) throw new Error(data.detail || res.statusText);
			setLoading(false, 'Prediction complete.');
			renderResult(data);
		} catch (err) {
			setLoading(false, '');
			resultEl.innerHTML = `<div class="card"><strong>Error:</strong> ${err.message || err}</div>`;
		}
	});

	function renderResult(data) {
		const { predictions = [], meaning = [] } = data || {};
		const total = predictions.length;
		const numHigh = meaning.filter(m => m === 'High').length;
		const numLow = total - numHigh;
		const tableRows = predictions.map((p, i) => {
			const m = meaning[i];
			const badge = m === 'High' ? '<span class="badge ok">High</span>' : '<span class="badge low">Low</span>';
			return `<tr><td>${i+1}</td><td>${p}</td><td>${badge}</td></tr>`;
		}).join('');
		resultEl.innerHTML = `
			<div class="card">
				<div style="display:flex;justify-content:space-between;align-items:center;gap:8px;flex-wrap:wrap;">
					<div><strong>Results</strong></div>
					<div class="help">Total: ${total} • High: ${numHigh} • Low: ${numLow}</div>
				</div>
				<div style="overflow:auto;margin-top:10px;">
					<table>
						<thead><tr><th>#</th><th>Prediction</th><th>Meaning</th></tr></thead>
						<tbody>${tableRows}</tbody>
					</table>
				</div>
			</div>
		`;
	}
	</script>
</body>
</html>